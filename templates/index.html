<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LinkIt - Pendekkan Kontenmu!</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .content-section { display: none; }
    .content-section.active { display: block; }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-6">LinkIt - Pendekkan Kontenmu!</h1>

    {% if user %}
    <div class="flex justify-between items-center mb-4">
      <p>Selamat datang, {{ user.email }} | <a href="{{ url_for('logout') }}" class="text-blue-500 hover:underline">Logout</a></p>
      <a href="{{ url_for('dashboard') }}" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Lihat Dashboard</a>
    </div>

    <form id="shorten-form" action="{{ url_for('shorten') }}" method="POST" enctype="multipart/form-data" class="bg-white p-6 rounded shadow-md">
      <div class="mb-4">
        <label for="content_type" class="block text-sm font-medium text-gray-700">Jenis Konten</label>
        <select id="content_type" name="content_type" class="mt-1 block w-full p-2 border rounded" onchange="showContentSection()">
          <option value="url">URL</option>
          <option value="text">Teks</option>
          <option value="image">Gambar</option>
          <option value="document">Dokumen</option>
        </select>
      </div>

      <div id="url-section" class="content-section active">
        <label for="url" class="block text-sm font-medium text-gray-700">Masukkan URL</label>
        <input type="text" id="url" name="url" class="mt-1 block w-full p-2 border rounded">
      </div>

      <div id="text-section" class="content-section">
        <label for="text" class="block text-sm font-medium text-gray-700">Masukkan Teks</label>
        <textarea id="text" name="text" rows="4" class="mt-1 block w-full p-2 border rounded"></textarea>
      </div>

      <div id="file-section" class="content-section">
        <label for="file" id="file-label" class="block text-sm font-medium text-gray-700">Unggah File</label>
        <input type="file" id="file" name="file" class="mt-1 block w-full p-2 border rounded">
      </div>

      <div class="mb-4">
        <label for="custom_code" class="block text-sm font-medium text-gray-700">Kode Kustom (opsional, 3-10 karakter)</label>
        <input type="text" id="custom_code" name="custom_code" class="mt-1 block w-full p-2 border rounded">
        <p id="custom-code-error" class="text-red-500 text-sm mt-1 hidden">Kode kustom tidak valid! Gunakan 3-10 karakter (huruf, angka, _, -).</p>
      </div>

      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">Pendekkan</button>
    </form>

    {% if success %}
    <div id="success-message" class="mt-4 p-4 bg-green-100 text-green-700 rounded">
      <p>{{ success }}</p>
      <div class="mt-2">
        <input type="text" id="short-url" value="{{ short_url }}" class="w-full p-2 border rounded" readonly>
        <button onclick="copyToClipboard()" class="mt-2 bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300">Salin</button>
      </div>
    </div>
    {% endif %}
    {% if error %}
    <div id="error-message" class="mt-4 p-4 bg-red-100 text-red-700 rounded">
      <p>{{ error }}</p>
    </div>
    {% endif %}
    {% else %}
    <p class="text-center">Silakan <a href="{{ url_for('login') }}" class="text-blue-500 hover:underline">login</a> atau <a href="{{ url_for('register') }}" class="text-blue-500 hover:underline">register</a> untuk membuat link pendek.</p>
    {% endif %}
  </div>

  <div id="logout-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow-md">
      <h2 class="text-lg font-bold mb-4">Konfirmasi Logout</h2>
      <p>Yakin ingin logout?</p>
      <div class="mt-4 flex justify-end">
        <a href="{{ url_for('logout') }}" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 mr-2">Ya, Logout</a>
        <button onclick="closeModal()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300">Batal</button>
      </div>
    </div>
  </div>

  <script>
    function showContentSection() {
      const contentType = document.getElementById('content_type').value;

      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });

      if (contentType === 'url') {
        document.getElementById('url-section').classList.add('active');
      } else if (contentType === 'text') {
        document.getElementById('text-section').classList.add('active');
      } else if (contentType === 'image' || contentType === 'document') {
        document.getElementById('file-section').classList.add('active');

        const fileInput = document.getElementById('file');
        const fileLabel = document.getElementById('file-label');

        if (contentType === 'image') {
          fileInput.accept = '.jpg,.jpeg,.png';
          fileLabel.innerText = 'Unggah Gambar (JPG, PNG)';
        } else {
          fileInput.accept = '.pdf,.docx';
          fileLabel.innerText = 'Unggah Dokumen (PDF, DOCX)';
        }
      }
    }

    function copyToClipboard() {
      const shortUrl = document.getElementById('short-url');
      shortUrl.select();
      document.execCommand('copy');
      alert('Link telah disalin!');
    }

    function closeModal() {
      document.getElementById('logout-modal').classList.add('hidden');
    }

    // Validasi kode kustom secara real-time
    document.getElementById('custom_code').addEventListener('input', function () {
      const code = this.value;
      const errorElement = document.getElementById('custom-code-error');
      const regex = /^[a-zA-Z0-9_-]{3,10}$/;
      errorElement.classList.toggle('hidden', regex.test(code) || !code);
    });

    // Tampilkan section awal yang aktif (default URL)
    window.onload = function () {
      showContentSection();
      const successMessage = document.getElementById('success-message');
      if (successMessage) {
        successMessage.scrollIntoView({ behavior: 'smooth' });
      }
    };
  </script>
</body>
</html>
